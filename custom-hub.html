<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="css/azure-styles.css">
    <script src="sdk/scripts/VSS.SDK.min.js"></script>
    <script type="text/javascript">
        VSS.init({
            explicitNotifyLoaded: true,
            usePlatformStyles: true
        });

        VSS.require(["TFS/Dashboards/WidgetHelpers", "VSS/Service", "TFS/Build/RestClient"], async function (WidgetHelpers, VSS_Service, TFS_Build_WebApi) {
            const projectId = VSS.getWebContext().project.id;
            let buildClient = VSS_Service.getCollectionClient(TFS_Build_WebApi.BuildHttpClient5);
            let commonMethods = VSS_Service.getCollectionClient(TFS_Build_WebApi.CommonMethods3To5);
            let commonMethods2To5 = VSS_Service.getCollectionClient(TFS_Build_WebApi.CommonMethods2To5);

            console.log("TFS_Build_WebApi:", TFS_Build_WebApi);

            commonMethods.getFolders(projectId).then((folders) => {
                folders.forEach(folder => {
                    if (folder.path === '\\') {
                        buildClient.getDefinitions(projectId, null, null, null, null, null, null, null, null, "\\").then((definitions) => {
                            for (let i = 0; i < definitions.length; i++) {
                                const pipelineItem = createPipelineItem(definitions[i]);
                                pipelineList.appendChild(pipelineItem);
                            }
                        }).catch((error) => {
                            console.error("Error fetching definitions:", error);
                        });
                    }
                    else {
                        createPipelineFolder(folder);
                        // pipelineList.appendChild(pipelineItem);
                    }
                });
            }).catch((error) => {
                console.error("Error fetching folders:", error);
            });

            commonMethods2To5.getTags(projectId).then((tags) => {
                const tagsDropdown = document.getElementById("tagsDropdown");
                tags.forEach(tag => {
                    const tagItem = document.createElement("div");
                    tagItem.className = "dropdown-item";
                    tagItem.setAttribute("data-value", tag);
                    tagItem.textContent = tag;
                    tagsDropdown.appendChild(tagItem);
                });
            }).catch((error) => {
                console.error("Error fetching tags:", error);
            });

            VSS.notifyLoadSucceeded();
        });

    </script>
    <script src="sdk/scripts/pipelines.js"></script>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1 class="page-title">Pipelines</h1>
        </div>
        <div>
            <div class="filter-container">
                <!-- Hamburger menu -->
                <button class="hamburger-menu" id="hamburgerMenu">
                </button>

                <!-- Search input -->
                <input type="text" class="search-input" placeholder="Filter by pipeline name or run number"
                    id="searchInput">
                <div class="divider"></div>

                <!-- State filter dropdown -->
                <div class="filter-dropdown">
                    <button class="dropdown-button" id="stateButton" aria-label="State">
                        State
                        <span class="dropdown-arrow"></span>
                    </button>
                    <div class="dropdown-content" id="stateDropdown">
                        <div class="dropdown-item" data-value="all">All States</div>
                        <div class="dropdown-item" data-value="completed">Completed</div>
                        <div class="dropdown-item" data-value="running">Running</div>
                        <div class="dropdown-item" data-value="failed">Failed</div>
                        <div class="dropdown-item" data-value="cancelled">Cancelled</div>
                    </div>
                </div>

                <!-- Repository filter dropdown -->
                <div class="filter-dropdown">
                    <button class="dropdown-button" id="repositoryButton" aria-label="Repository">
                        Repository
                        <span class="dropdown-arrow"></span>
                    </button>
                    <div class="dropdown-content" id="repositoryDropdown">
                        <div class="dropdown-item" data-value="all" aria-details="">All Repositories</div>
                    </div>
                </div>

                <!-- Branch filter dropdown -->
                <!-- <div class="filter-dropdown">
                        <button class="dropdown-button" id="branchButton">
                            Branch
                            <span class="dropdown-arrow">&#x25BC;</span>
                        </button>
                        <div class="dropdown-content" id="branchDropdown">
                            <div class="dropdown-item" data-value="all">All Branches</div>
                            <div class="dropdown-item" data-value="main">main</div>
                            <div class="dropdown-item" data-value="develop">develop</div>
                            <div class="dropdown-item" data-value="feature">feature/*</div>
                            <div class="dropdown-item" data-value="release">release/*</div>
                        </div>
                    </div> -->

                <!-- Requested for filter dropdown -->
                <!-- <div class="filter-dropdown">
                        <button class="dropdown-button" id="requestedForButton">
                            Requested for
                            <span class="dropdown-arrow">&#x25BC;</span>
                        </button>
                        <div class="dropdown-content" id="requestedForDropdown">
                            <div class="dropdown-item" data-value="all">All Users</div>
                            <div class="dropdown-item" data-value="me">Me</div>
                            <div class="dropdown-item" data-value="john">John Doe</div>
                            <div class="dropdown-item" data-value="jane">Jane Smith</div>
                            <div class="dropdown-item" data-value="team">Team Members</div>
                        </div>
                    </div> -->

                <!-- Tags filter dropdown -->
                <div class="filter-dropdown">
                    <button class="dropdown-button" id="tagsButton" aria-label="Tags">
                        Tags
                        <span class="dropdown-arrow"></span>
                    </button>
                    <div class="dropdown-content" id="tagsDropdown">
                        <div class="dropdown-item" data-value="all">All Tags</div>
                    </div>
                </div>

                <div class="divider"></div>

                <!-- Close button -->
                <button class="close-button" id="closeButton">
                    &#x2715;
                </button>
            </div>
        </div>

        <div class="content-container">
            <div class="content-section-extension">
                <!-- <div class="section-header">
                    <h2 class="section-title">All pipelines</h2>
                </div> -->


                <!-- <div class="table-header">
                    <div class="table-header-text" style="flex:4;">Name</div>
                    <div class="table-header-text" style="flex:1;">Status</div>
                    <div class="table-header-text pipeline-status-badge">Last build status</div>
                </div> -->

                <div class="pipeline-list" id="pipelineList">
                    <div class="pipeline-item">sample pipeline</div>
                </div>
            </div>
        </div>
        <script src="sdk/scripts/filter.js"></script>
    </div>
</body>

</html>